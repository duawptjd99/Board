<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${boardDto.getTitle()}"></title>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.0.2/css/bootstrap.min.css}"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.css">

</head>
<body>
<header>

</header>
<main>
    <div>
        <input id="board-id" name="id" type="hidden" th:value="${boardDto.getId()}">
        <textarea id="title-editor" name="title" th:utext="${boardDto.getTitle()}"></textarea>
        <hr/>
        <textarea id="content-editor" name="content" th:utext="${boardDto.getContent()}" }></textarea>
        <hr/>
        <button onclick="submitForm()">완료</button>
        <form th:action="@{/home/board}" method="get">
            <input name="id" type="hidden" th:value="${boardDto.getId()}">
            <button type="submit">취소</button>
        </form>
        <hr/>
    </div>
</main>
<footer>

</footer>
</body>
</html>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote/lang/summernote-ko-KR.js"></script>

<script>
    function checkEmpty() {
        var title = document.getElementById("title").value;
        var content = document.getElementById("content").value;

        if (title !== "" && content !== "") {

            return true;
        } else {

            return false;
        }
    }

    $(document).ready(function () {
        $('#title-editor').summernote({
            lang: 'ko-KR', // 한국어로 설정
            toolbar: [
                ['style', ['bold', 'italic', 'underline']],
                ['font', ['strikethrough']],
                ['fontname'],
                ['fontsize'],
                ['color'],], // 툴바를 숨김
            height: 50, // 에디터의 높이 설정
        });
        $('#content-editor').summernote({
            lang: 'ko-KR', // 한국어로 설정
            toolbar: [
                ['style', ['bold', 'italic', 'underline']],
                ['font', ['strikethrough']],
                ['fontname'],
                ['fontsize'],
                ['color'],
                ['para', ['ul', 'ol']],
                ['insert', ['picture']],
            ],
            buttons: {
                picture: function (context) {
                    var ui = $.summernote.ui;
                    var button = ui.button({
                        contents: '<i class="note-icon-picture"></i>',
                        tooltip: '그림 삽입',
                        click: function () {
                            // 그림 삽입 버튼을 클릭했을 때 동작할 내용
                            // 파일 관리기 열기 등의 기능을 구현
                        }
                    });
                    return button.render();
                }
            },
            height: 300 // 에디터의 높이 설정
        });
        $('.dropdown-toggle').dropdown();
    });

    function submitForm() {
        const title = $('#title-editor').summernote('code');
        const content = $('#content-editor').summernote('code');
        const boardId = document.getElementById("board-id").value;

        const formData = new FormData();
        formData.append("id", boardId);
        formData.append("title", title);
        formData.append("content", content);

        $.ajax({
            url: "/home/board/update",
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            enctype: 'multipart/form-data',
            success: function (response) {
                alert("글 수정이 완료되었습니다.");
                window.location.href = "/home/board?id=" + formData.get("id");
            },
            error: function (xhr, status, error) {
                alert("글 수정에 실패했습니다. 다시 시도해주세요.");
            }
        });
    }
</script>